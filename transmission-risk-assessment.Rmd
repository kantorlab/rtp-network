
Building on the datasets sent to [Vlad](https://github.com/kantorlab/rtp-network/blob/main/vlads-questions.Rmd),
I should now be able to assess the serodiscordance status of the partners.

Assessment of the transmission potential from risk of index cases to transmit?
Risk of named partners who are of unkown HIV status to become infected?

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
```

```{r}
data_dir <- "/gpfs/data/rkantor/rtp/datasets/D30_20211013_V1"
list.files(path=data_dir)
net_dt <- fread(paste0(data_dir, "/ContactTracingNetwork.csv"))
individuals_dt <- fread(paste0(data_dir, "/Individuals.csv"))
```
As in that previous analysis, 
order the networks dataset in descending order of `StudyIDFrom`, `ReferralDate`,
and `StudyIDTo`: 

```{r}
net_dt[,.N, by=c("StudyIDFrom", "ReferralDate")][order(-StudyIDFrom)]
net_dt[,.N, by=c("StudyIDFrom", "ReferralDate", "StudyIDTo")][order(-StudyIDFrom)]
```

Repeat the above step with Referral Date denoted in YYYY format:

```{r}
RD_YYYY <- substr(net_dt$ReferralDate, 1, 4)
net_dt[, `:=` (RD_YYYY = RD_YYYY)]
head(net_dt)

net_dt[,.N, by=c("StudyIDFrom", "RD_YYYY", "StudyIDTo")][order(-StudyIDFrom)]
```

Distribution of `StudyIDFrom` column from the contact tracing dataset 
that appear in the individuals dataset.  

```{r}
length(net_dt$StudyIDFrom)

length(which(net_dt$StudyIDFrom %in% individuals_dt$StudyID))

length(which(!(net_dt$StudyIDFrom %in% individuals_dt$StudyID)))
head(which(!(net_dt$StudyIDFrom %in% individuals_dt$StudyID)))

studyidfrom_not_in_ind <- 
  net_dt$StudyIDFrom[(which(!(net_dt$StudyIDFrom %in% individuals_dt$StudyID)))]

table(substr(studyidfrom_not_in_ind, 1, 5))

length(unique(studyidfrom_not_in_ind))

table(substr(unique(studyidfrom_not_in_ind), 1, 5))
```
Distribution of `StudyIDTo` column from the contact tracing dataset 
that appear in the individuals dataset.

```{r}
length(net_dt$StudyIDTo)

length(which(net_dt$StudyIDTo %in% individuals_dt$StudyID))

length(which(!(net_dt$StudyIDTo %in% individuals_dt$StudyID)))
head(which(!(net_dt$StudyIDTo %in% individuals_dt$StudyID)))

studyidfrom_not_in_ind <- 
  net_dt$StudyIDTo[(which(!(net_dt$StudyIDTo %in% individuals_dt$StudyID)))]

table(substr(studyidfrom_not_in_ind, 1, 5))

length(unique(studyidfrom_not_in_ind))

table(substr(unique(studyidfrom_not_in_ind), 1, 5))
```